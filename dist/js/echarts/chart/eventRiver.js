/*! myResume 2015-07-06 */
define("echarts/chart/eventRiver",["require","./base","../layout/eventRiver","zrender/shape/Polygon","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","../util/date","zrender/tool/util","zrender/tool/color","../chart"],function(a){function b(a,b,d,e,f){c.call(this,a,b,d,e,f);var g=this;g._ondragend=function(){g.isDragend=!0},this.refresh(e)}var c=a("./base"),d=a("../layout/eventRiver"),e=a("zrender/shape/Polygon");a("../component/axis"),a("../component/grid"),a("../component/dataZoom");var f=a("../config");f.eventRiver={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"inside",formatter:"{b}"}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0}}}};var g=a("../util/ecData"),h=a("../util/date"),i=a("zrender/tool/util"),j=a("zrender/tool/color");return b.prototype={type:f.CHART_TYPE_EVENTRIVER,_buildShape:function(){var a=this.series;this.selectedMap={},this._dataPreprocessing();for(var b=this.component.legend,c=[],e=0;e<a.length;e++)if(a[e].type===this.type){a[e]=this.reformOption(a[e]),this.legendHoverLink=a[e].legendHoverLink||this.legendHoverLink;var f=a[e].name||"";if(this.selectedMap[f]=b?b.isSelected(f):!0,!this.selectedMap[f])continue;this.buildMark(e),c.push(this.series[e])}d(c,this._intervalX,this.component.grid.getArea()),this._drawEventRiver(),this.addShapeList()},_dataPreprocessing:function(){for(var a,b,c=this.series,d=0,e=c.length;e>d;d++)if(c[d].type===this.type){a=this.component.xAxis.getAxis(c[d].xAxisIndex||0);for(var f=0,g=c[d].data.length;g>f;f++){b=c[d].data[f].evolution;for(var i=0,j=b.length;j>i;i++)b[i].timeScale=a.getCoord(h.getNewDate(b[i].time)-0),b[i].valueScale=Math.pow(b[i].value,.8)}}this._intervalX=Math.round(this.component.grid.getWidth()/40)},_drawEventRiver:function(){for(var a=this.series,b=0;b<a.length;b++){var c=a[b].name||"";if(a[b].type===this.type&&this.selectedMap[c])for(var d=0;d<a[b].data.length;d++)this._drawEventBubble(a[b].data[d],b,d)}},_drawEventBubble:function(a,b,c){var d=this.series,f=d[b],h=f.name||"",i=f.data[c],k=[i,f],l=this.component.legend,m=l?l.getColor(h):this.zr.getColor(b),n=this.deepMerge(k,"itemStyle.normal")||{},o=this.deepMerge(k,"itemStyle.emphasis")||{},p=this.getItemStyleColor(n.color,b,c,i)||m,q=this.getItemStyleColor(o.color,b,c,i)||("string"==typeof p?j.lift(p,-.2):p),r=this._calculateControlPoints(a),s={zlevel:f.zlevel,z:f.z,clickable:this.deepQuery(k,"clickable"),style:{pointList:r,smooth:"spline",brushType:"both",lineJoin:"round",color:p,lineWidth:n.borderWidth,strokeColor:n.borderColor},highlightStyle:{color:q,lineWidth:o.borderWidth,strokeColor:o.borderColor},draggable:"vertical",ondragend:this._ondragend};s=new e(s),this.addLabel(s,f,i,a.name),g.pack(s,d[b],b,d[b].data[c],c,d[b].data[c].name),this.shapeList.push(s)},_calculateControlPoints:function(a){var b=this._intervalX,c=a.y,d=a.evolution,e=d.length;if(!(1>e)){for(var f=[],g=[],h=0;e>h;h++)f.push(d[h].timeScale),g.push(d[h].valueScale);var i=[];i.push([f[0],c]);var h=0;for(h=0;e-1>h;h++)i.push([(f[h]+f[h+1])/2,g[h]/-2+c]);for(i.push([(f[h]+(f[h]+b))/2,g[h]/-2+c]),i.push([f[h]+b,c]),i.push([(f[h]+(f[h]+b))/2,g[h]/2+c]),h=e-1;h>0;h--)i.push([(f[h]+f[h-1])/2,g[h-1]/2+c]);return i}},ondragend:function(a,b){this.isDragend&&a.target&&(b.dragOut=!0,b.dragIn=!0,b.needRefresh=!1,this.isDragend=!1)},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()}},i.inherits(b,c),a("../chart").define("eventRiver",b),b}),define("echarts/layout/eventRiver",["require"],function(a){function b(a,b,g){function h(a,b){var c=a.importance,d=b.importance;return c>d?-1:d>c?1:0}function i(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}for(var j=5,k=b,l=0;l<a.length;l++){for(var m=0;m<a[l].data.length;m++){null==a[l].data[m].weight&&(a[l].data[m].weight=1);for(var n=0,o=0;o<a[l].data[m].evolution.length;o++)n+=a[l].data[m].evolution[o].valueScale;a[l].data[m].importance=n*a[l].data[m].weight}a[l].data.sort(h)}for(var l=0;l<a.length;l++){null==a[l].weight&&(a[l].weight=1);for(var n=0,m=0;m<a[l].data.length;m++)n+=a[l].data[m].weight;a[l].importance=n*a[l].weight}a.sort(h);for(var p=Number.MAX_VALUE,q=0,l=0;l<a.length;l++)for(var m=0;m<a[l].data.length;m++)for(var o=0;o<a[l].data[m].evolution.length;o++){var r=a[l].data[m].evolution[o].timeScale;p=Math.min(p,r),q=Math.max(q,r)}for(var s=d(Math.floor(p),Math.ceil(q)),t=0,l=0;l<a.length;l++)for(var m=0;m<a[l].data.length;m++){var u=a[l].data[m];u.time=[],u.value=[];for(var o=0;o<a[l].data[m].evolution.length;o++)u.time.push(a[l].data[m].evolution[o].timeScale),u.value.push(a[l].data[m].evolution[o].valueScale);var v=i(u.value,Math.max.apply(Math,u.value)),w=e(s,u.time[v],u.time[v+1]),o=0;for(u.y=w+u.value[v]/2+j,o=0;o<u.time.length-1;o++){var x=e(s,u.time[o],u.time[o+1]);u.y-u.value[o]/2-j<x&&(u.y=x+u.value[o]/2+j)}var x=e(s,u.time[o],u.time[o]+k);for(u.y-u.value[o]/2-j<x&&(u.y=x+u.value[o]/2+j),a[l].y=u.y,t=Math.max(t,u.y+u.value[v]/2),o=0;o<u.time.length-1;o++)f(s,u.time[o],u.time[o+1],u.y+u.value[o]/2);f(s,u.time[o],u.time[o]+k,u.y+u.value[o]/2)}c(a,g,t,j)}function c(a,b,c,d){for(var e=b.y,f=(b.height-d)/c,g=0;g<a.length;g++){a[g].y=a[g].y*f+e;for(var h=a[g].data,i=0;i<h.length;i++){h[i].y=h[i].y*f+e;for(var j=h[i].evolution,k=0;k<j.length;k++)j[k].valueScale*=1*f}}}function d(a,b){var c={left:a,right:b,leftChild:null,rightChild:null,maxValue:0};if(b>a+1){var e=Math.round((a+b)/2);c.leftChild=d(a,e),c.rightChild=d(e,b)}return c}function e(a,b,c){if(1>c-b)return 0;var d=Math.round((a.left+a.right)/2),f=0;if(b==a.left&&c==a.right)f=a.maxValue;else if(d>=c&&null!=a.leftChild)f=e(a.leftChild,b,c);else if(b>=d&&null!=a.rightChild)f=e(a.rightChild,b,c);else{var g=0,h=0;null!=a.leftChild&&(g=e(a.leftChild,b,d)),null!=a.rightChild&&(h=e(a.rightChild,d,c)),f=g>h?g:h}return f}function f(a,b,c,d){if(null!=a){var e=Math.round((a.left+a.right)/2);a.maxValue=a.maxValue>d?a.maxValue:d,(Math.floor(10*b)!=Math.floor(10*a.left)||Math.floor(10*c)!=Math.floor(10*a.right))&&(e>=c?f(a.leftChild,b,c,d):b>=e?f(a.rightChild,b,c,d):(f(a.leftChild,b,e,d),f(a.rightChild,e,c,d)))}}return b});